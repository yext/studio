name: Playwright Tests

on: push

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
    timeout-minutes: 60
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npm run build
      - run: npx playwright install --with-deps
      - run: npm i
      - name: Run Playwright
        run: npm run playwright
      - uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: ./e2e-tests/playwright-report/
          retention-days: 30
      # Commits new screenshots to the repo, if any exist
      - name: Commit New Screenshots
        uses: EndBug/add-and-commit@v9
        with:
          message: "Commit new screenshots"
          add: "e2e-tests/tests/**/*.png"
          push: true
          default_author: github_actions
